<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVT Dream Bank 2026</title>
    <style>
        :root { --rose: #F7CAC9; --serenity: #92A8D1; --purple: #d1d1ff; --gold: #fff3cd; --text: #444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: -apple-system, "PingFang TC", sans-serif; background: #fcfafb; margin: 0; padding-bottom: 140px; color: var(--text); }
        
        /* æ¨™é ­ */
        .header-fixed { position: sticky; top: 0; z-index: 1000; background: linear-gradient(to right, #f7cac9, #92a8d1); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 19px; letter-spacing: 1px; }

        /* ç¸½é¡èˆ‡æ—¥æœŸå€ */
        .top-info { background: white; margin: 12px; padding: 15px; border-radius: 15px; border: 2px solid var(--rose); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        #totalDisplay { font-size: 26px; font-weight: bold; color: #e84393; }

        /* --- æ–°å¢ï¼šå€æ•¸é¸æ“‡å™¨ --- */
        .qty-selector { background: #eee; margin: 0 12px 15px; padding: 5px; border-radius: 12px; display: flex; gap: 5px; align-items: center; }
        .qty-label { font-size: 12px; font-weight: bold; color: #777; padding: 0 8px; }
        .qty-btn { flex: 1; border: none; padding: 8px; border-radius: 8px; background: white; font-size: 14px; cursor: pointer; transition: 0.2s; color: #555; }
        .qty-btn.active { background: var(--serenity); color: white; font-weight: bold; }

        /* æˆå“¡å¡ç‰‡æ’ç‰ˆ */
        .member-card { background: white; margin: 0 12px 20px; padding: 18px; border-radius: 20px; border: 1px solid #f0f0f0; box-shadow: 0 6px 15px rgba(0,0,0,0.05); }
        .member-name { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; border-bottom: 1px solid #f9f9f9; padding-bottom: 8px; }
        
        /* æŒ‰éˆ•ç¶²æ ¼èˆ‡é¡è‰² */
        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .btn-action { 
            padding: 14px 5px; background: #fff; border: 1px solid #eee; border-radius: 12px; 
            font-size: 14px; color: #555; font-weight: 500; cursor: pointer; transition: 0.1s;
        }
        .btn-action:active { transform: scale(0.95); background: #f0f0f0; }
        
        /* å¼·åˆ¶æŒ‰éˆ•é¡è‰² */
        #btn-live-wvs, #btn-live-ig { background-color: #fff9db !important; border-color: #f1c40f !important; color: #d35400 !important; font-weight: bold; }
        #btn-ig-photo { background-color: #f5f6fa !important; border-color: #9b59b6 !important; color: #9b59b6 !important; font-weight: bold; }

        /* ç‰¹æ•ˆèˆ‡å‹•ç•« */
        .plus-money { position: absolute; color: #e84393; font-weight: bold; animation: floatUp 0.8s forwards; z-index: 1000; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-40px); } }

        /* æ˜ç´°å€åŸŸ */
        .log-area { margin: 15px 12px; background: #f8f9fa; padding: 18px; border-radius: 15px; }
        .day-total-tag { background: linear-gradient(135deg, var(--rose), var(--serenity)); color: white; padding: 8px 16px; border-radius: 20px; margin-bottom: 15px; font-size: 14px; display: inline-block; }
        .log-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #ddd; font-size: 14px; }

        /* æ¼”å”±æœƒæ¨£å¼ */
        .concert-form { background: white; margin: 12px; padding: 20px; border-radius: 20px; border: 2px solid var(--serenity); }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 12px; color: #888; margin-bottom: 4px; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px; font-size: 15px; }

        /* åº•éƒ¨å°èˆª */
        .footer { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); padding: 10px 20px 30px 20px; border-top: 1px solid #eee; backdrop-filter: blur(10px); display: flex; gap: 12px; z-index: 2000; }
        .nav-btn { flex: 1; padding: 14px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; }
        .btn-main { background: var(--rose); color: white; box-shadow: 0 4px 10px rgba(247,202,201,0.5); }
        .btn-sub { background: white; border: 1px solid var(--serenity); color: var(--serenity); }
        
        .view-section { display: none; }
        .view-active { display: block; }
    </style>
</head>
<body>

<div class="header-fixed"><h1 id="pageTitle">ğŸ’ 2026 SVT Dream Bank</h1></div>

<div class="top-info">
    <div id="dateSection"><input type="date" id="dateInput" onchange="updateDate()" style="border:none; font-size:16px; outline:none;"></div>
    <div id="countSection" style="display:none; color:var(--purple); font-weight:bold;">è¦‹é¢æ¬¡æ•¸ï¼š<span id="meetCount">0</span></div>
    <div id="totalDisplay">$0</div>
</div>

<div id="saveView" class="view-section view-active">
    <div class="qty-selector">
        <div class="qty-label">ä¸€æ¬¡è¨˜å¹¾å‰‡ï¼Ÿ</div>
        <button class="qty-btn active" onclick="setQty(1, this)">1</button>
        <button class="qty-btn" onclick="setQty(3, this)">3</button>
        <button class="qty-btn" onclick="setQty(5, this)">5</button>
        <button class="qty-btn" onclick="setQty(10, this)">10</button>
        <button class="qty-btn" onclick="askQty(this)">è‡ªè¨‚</button>
    </div>

    <div id="memberList"></div>
    
    <div class="log-area">
        <div style="font-weight:bold; margin-bottom:12px; color:#888;">ğŸ“‹ ä»Šæ—¥æ˜ç´°</div>
        <div id="logList"></div>
    </div>
</div>

<div id="concertView" class="view-section">
    <div class="concert-form">
        <div class="form-group"><label>æ¼”å”±æœƒåç¨±</label><input type="text" id="c_name" placeholder="FOLLOW AGAIN"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div class="form-group"><label>è²·ç¥¨æ—¥</label><input type="date" id="c_buyDate"></div>
            <div class="form-group"><label>æ´»å‹•æ—¥</label><input type="date" id="c_showDate"></div>
        </div>
        <div class="form-group"><label>åº§ä½</label><input type="text" id="c_seat" placeholder="VIP A2"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div class="form-group"><label>ç¥¨åƒ¹</label><input type="number" id="c_price" placeholder="5800"></div>
            <div class="form-group"><label>æ‰‹çºŒè²»</label><input type="number" id="c_fee" placeholder="150"></div>
        </div>
        <button class="nav-btn btn-main" style="width:100%; margin-top:10px;" onclick="addConcert()">ç¢ºèªå„²å­˜ä¸¦æ‰£æ¬¾</button>
    </div>
    <div id="concertList" style="margin-bottom: 30px;"></div>
</div>

<div class="footer">
    <button id="btnToSave" class="nav-btn btn-main" onclick="switchView('save')">ğŸ’° å­˜éŒ¢</button>
    <button id="btnToConcert" class="nav-btn btn-sub" onclick="switchView('concert')">ğŸŸï¸ æˆå°±</button>
</div>

<script>
    let currentQty = 1;
    const prices = {
        wonwoo: { w_p: 50, w_m: 20, w_s: 30, w_l: 200, i_p: 50, i_s: 30, i_photo: 50, i_live: 200, extra: 10 },
        others: { w_p: 20, w_m: 10, w_s: 10, w_l: 50, i_p: 20, i_s: 10, i_live: 50, extra: 10 }
    };
    const members = [
        {en:"S.coups", ko:"ìŠ¹ì² ", vip:false}, {en:"Jeonghan", ko:"ì •í•œ", vip:false},
        {en:"Joshua", ko:"ì§€ìˆ˜", vip:false}, {en:"Jun", ko:"ì¤€íœ˜", vip:false},
        {en:"Hoshi", ko:"ìˆœì˜", vip:false}, {en:"Wonwoo", ko:"ì›ìš°", vip:true},
        {en:"Woozi", ko:"ì§€í›ˆ", vip:false}, {en:"The8", ko:"ëª…í˜¸", vip:false},
        {en:"Mingyu", ko:"ë¯¼ê·œ", vip:false}, {en:"DK", ko:"ì„ë¯¼", vip:false},
        {en:"Seungkwan", ko:"ìŠ¹ê´€", vip:false}, {en:"Vernon", ko:"í•œì†”", vip:false},
        {en:"Dino", ko:"ì°¬", vip:false}
    ];

    let state = { total: 0, currentDate: new Date().toISOString().split('T')[0], allLogs: {}, concertLogs: [] };

    // --- å€æ•¸é¸æ“‡é‚è¼¯ ---
    function setQty(val, btn) {
        currentQty = val;
        document.querySelectorAll('.qty-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function askQty(btn) {
        const val = prompt("è«‹è¼¸å…¥è‡ªå®šç¾©æ•¸é‡ï¼š", "20");
        if(val && !isNaN(val)) {
            currentQty = parseInt(val);
            btn.innerText = `x${val}`;
            setQty(currentQty, btn);
        }
    }

    // --- æ ¸å¿ƒé‚è¼¯ ---
    function add(name, act, price, event) {
        const totalAdd = price * currentQty;
        const dk = state.currentDate;
        if (!state.allLogs[dk]) state.allLogs[dk] = [];
        
        const label = currentQty > 1 ? `${act} (x${currentQty})` : act;
        state.allLogs[dk].push({ id: Date.now(), amt: totalAdd, text: `${name} ${label}` });
        
        if(event) triggerEffect(event.currentTarget, totalAdd);
        recalculateTotal();
    }

    function triggerEffect(el, amt) {
        const rect = el.getBoundingClientRect();
        const div = document.createElement('div');
        div.className = 'plus-money';
        div.innerText = `+$${amt}`;
        div.style.left = `${rect.left + rect.width/2}px`;
        div.style.top = `${rect.top + window.scrollY}px`;
        document.body.appendChild(div);
        setTimeout(() => div.remove(), 800);
    }

    function recalculateTotal() {
        let income = 0;
        let expense = 0;
        Object.keys(state.allLogs).forEach(d => {
            state.allLogs[d].forEach(l => income += l.amt);
        });
        state.concertLogs.forEach(c => expense += c.totalCost);
        state.total = income - expense;
        save();
    }

    function save() {
        localStorage.setItem('SVT_FINAL_STABLE_V1', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('totalDisplay').innerText = `$${state.total.toLocaleString()}`;
        document.getElementById('dateInput').value = state.currentDate;
        renderLogs();
    }

    function renderLogs() {
        const div = document.getElementById('logList');
        const logs = state.allLogs[state.currentDate] || [];
        const dayTotal = logs.reduce((s, l) => s + l.amt, 0);
        const headerHtml = dayTotal > 0 ? `<div class="day-total-tag">ğŸ’° ä»Šæ—¥å°è¨ˆï¼šNT$ ${dayTotal.toLocaleString()}</div>` : '';
        div.innerHTML = headerHtml + logs.map(l => `
            <div class="log-item">
                <span>${l.text} ($${l.amt})</span>
                <span style="color:#ff7675; font-weight:bold; cursor:pointer;" onclick="undo(${l.id})">âœ–</span>
            </div>
        `).reverse().join('');
    }

    function undo(id) {
        const logs = state.allLogs[state.currentDate];
        const idx = logs.findIndex(l => l.id === id);
        if(idx !== -1) { logs.splice(idx, 1); recalculateTotal(); }
    }

    function switchView(mode) {
        const isSave = mode === 'save';
        document.getElementById('saveView').classList.toggle('view-active', isSave);
        document.getElementById('concertView').classList.toggle('view-active', !isSave);
        document.getElementById('btnToSave').className = isSave ? 'nav-btn btn-main' : 'nav-btn btn-sub';
        document.getElementById('btnToConcert').className = isSave ? 'nav-btn btn-sub' : 'nav-btn btn-main';
        document.getElementById('dateSection').style.display = isSave ? 'block' : 'none';
        document.getElementById('countSection').style.display = isSave ? 'none' : 'block';
        if(!isSave) renderConcerts();
    }

    function addConcert() {
        const name = document.getElementById('c_name').value;
        const price = parseInt(document.getElementById('c_price').value) || 0;
        const fee = parseInt(document.getElementById('c_fee').value) || 0;
        const showDate = document.getElementById('c_showDate').value;
        if(!name || !showDate) { alert("è«‹å¡«å¯«åç¨±èˆ‡æ—¥æœŸ"); return; }
        state.concertLogs.push({
            id: Date.now(), name, showDate, 
            totalCost: price + fee,
            seat: document.getElementById('c_seat').value
        });
        recalculateTotal();
        renderConcerts();
    }

    function renderConcerts() {
        const list = document.getElementById('concertList');
        document.getElementById('meetCount').innerText = state.concertLogs.length;
        list.innerHTML = state.concertLogs.map(c => `
            <div class="member-card" style="border-left: 5px solid gold;">
                <div style="display:flex; justify-content:space-between; font-weight:bold;">
                    <span>âœ¨ ${c.name}</span>
                    <span style="color:red;" onclick="deleteConcert(${c.id})">âœ–</span>
                </div>
                <div style="font-size:13px; color:#777; margin-top:5px;">ğŸ“… ${c.showDate} | ğŸ“ ${c.seat}</div>
                <div style="text-align:right; color:#e84393; font-weight:bold;">-$${c.totalCost.toLocaleString()}</div>
            </div>
        `).reverse().join('');
    }

    function deleteConcert(id) {
        state.concertLogs = state.concertLogs.filter(c => c.id !== id);
        recalculateTotal();
        renderConcerts();
    }

    function updateDate() { state.currentDate = document.getElementById('dateInput').value; save(); }

    function handleLive(idx, plat, event) {
        const m = members[idx];
        const p = m.vip ? prices.wonwoo : prices.others;
        const n = prompt(`ã€${m.en}ã€‘${plat}ç›´æ’­äººæ•¸ï¼Ÿ`, "1");
        if(n) {
            let base = (plat === 'WVS' ? p.w_l : p.i_live);
            let total = parseInt(base) + (parseInt(n)>1 ? (parseInt(n)-1)*p.extra : 0);
            add(m.en, `${plat}ç›´æ’­(${n}äºº)`, total, event);
        }
    }

    function init() {
        const saved = localStorage.getItem('SVT_FINAL_STABLE_V1');
        if(saved) state = JSON.parse(saved);
        if(!state.concertLogs) state.concertLogs = [];
        state.currentDate = new Date().toISOString().split('T')[0];

        const list = document.getElementById('memberList');
        members.forEach((m, i) => {
            const p = m.vip ? prices.wonwoo : prices.others;
            const card = document.createElement('div');
            card.className = 'member-card';
            card.innerHTML = `
                <div class="member-name">${m.en} <small style="color:#999; font-weight:normal;">${m.ko}</small> ${m.vip?'ğŸ’œ':''}</div>
                <div class="btn-grid">
                    <button class="btn-action" onclick="add('${m.en}','WVSç™¼æ–‡',${p.w_p},event)">WVSç™¼æ–‡</button>
                    <button class="btn-action" onclick="add('${m.en}','WVSç•™è¨€',${p.w_m},event)">WVSç•™è¨€</button>
                    <button class="btn-action" onclick="add('${m.en}','WVSé™å‹•',${p.w_s},event)">WVSé™å‹•</button>
                    <button id="btn-live-wvs" class="btn-action" onclick="handleLive(${i},'WVS',event)">WVSç›´æ’­</button>
                    <button class="btn-action" onclick="add('${m.en}','IGç™¼æ–‡',${p.i_p},event)">IGç™¼æ–‡</button>
                    <button class="btn-action" onclick="add('${m.en}','IGé™å‹•',${p.i_s},event)">IGé™å‹•</button>
                    <button id="btn-live-ig" class="btn-action" onclick="handleLive(${i},'IG',event)">IGç›´æ’­</button>
                    ${m.vip ? `<button id="btn-ig-photo" class="btn-action" onclick="add('${m.en}','IGæ”å½±å¸³',${p.i_photo},event)">IGæ”å½±å¸³</button>` : ''}
                </div>
            `;
            list.appendChild(card);
        });
        updateUI();
    }
    init();
</script>
</body>
</html>
