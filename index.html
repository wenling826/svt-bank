<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SVT Dream Bank</title>
    <style>
        :root { --rose: #F7CAC9; --serenity: #92A8D1; --text-gray: #8e8e93; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #fdfbfb; margin: 0; padding-bottom: 140px; user-select: none; -webkit-user-select: none; }
        
        .header { background: linear-gradient(to right, var(--rose), var(--serenity)); color: white; padding: 55px 15px 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 18px; font-weight: 800; }

        .top-card { background: white; margin: 15px; padding: 20px; border-radius: 20px; border: 2.5px solid var(--rose); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .total-val { color: #e84393; font-size: 28px; font-weight: 900; }
        #dateInput { border: none; font-size: 16px; font-weight: bold; color: #666; width: 135px; background: transparent; outline: none; }

        /* å€æ•¸å€åŸŸ */
        .m-bar { background: #f0f0f2; margin: 0 15px 15px; padding: 12px; border-radius: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .m-label { font-size: 14px; font-weight: bold; color: #555; }
        #customQty { width: 60px; padding: 8px; border: 1.5px solid var(--serenity); border-radius: 10px; text-align: center; font-size: 16px; font-weight: bold; color: var(--serenity); outline: none; }

        /* é€šç”¨å¡ç‰‡ */
        .card { background: white; margin: 15px; padding: 20px; border-radius: 22px; border: 1px solid #efefef; box-shadow: 0 5px 15px rgba(0,0,0,0.04); }
        .card-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; display: flex; align-items: baseline; gap: 8px; }
        .ko-name { font-size: 13px; color: var(--text-gray); font-weight: normal; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 15px 5px; border-radius: 14px; border: 1px solid #f2f2f2; background: #fff; font-size: 13px; font-weight: 600; color: #444; }
        .btn:active { background: #f0f0f0; transform: scale(0.96); }
        .btn-yellow { background-color: #FFF9C4 !important; border-color: #FBC02D !important; color: #F57F17 !important; }
        .btn-purple { background-color: #F3E5F5 !important; border-color: #9C27B0 !important; color: #9C27B0 !important; }

        /* æ¼”å”±æœƒè¡¨å–®æ’ç‰ˆä¿®æ­£ */
        .con-form { display: flex; flex-direction: column; gap: 12px; }
        .form-item { display: flex; flex-direction: column; gap: 5px; width: 100%; }
        .form-row { display: flex; gap: 10px; width: 100%; }
        .form-row .form-item { flex: 1; min-width: 0; } /* é˜²æ­¢ä¸¦æ’æ™‚æ“ å£“ */
        
        .con-form label { font-size: 13px; color: #888; margin-left: 2px; font-weight: 600; }
        .con-form input { padding: 14px 10px; border: 1.5px solid #eee; border-radius: 12px; font-size: 15px; outline: none; background: #fafafa; -webkit-appearance: none; width: 100%; box-sizing: border-box; }
        .con-form input:focus { border-color: var(--serenity); background: #fff; }

        /* ç¥¨å¡æ¨£å¼ */
        .ticket { background: #fff; border-left: 8px solid var(--serenity); position: relative; }
        .ticket-header { border-bottom: 1px dashed #ddd; padding-bottom: 10px; margin-bottom: 10px; padding-right: 30px; }
        .ticket-body { font-size: 14px; color: #555; line-height: 1.7; }
        .ticket-price { color: #e84393; font-weight: bold; font-size: 18px; margin-top: 8px; display: block; border-top: 1px solid #f9f9f9; padding-top: 5px; }
        .del-btn { position: absolute; top: 18px; right: 15px; color: #ccc; font-size: 20px; padding: 5px; }

        .logs { background: #fafafa; margin: 15px; padding: 15px; border-radius: 15px; border: 1px dashed #ddd; }
        .log-line { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }

        .footer { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.92); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); padding: 15px 15px 40px; display: flex; gap: 12px; border-top: 1px solid #eee; box-sizing: border-box; z-index: 9999; }
        .f-btn { flex: 1; padding: 16px; border-radius: 30px; border: none; font-weight: bold; font-size: 16px; text-align: center; }
        .f-on { background: var(--rose); color: white; box-shadow: 0 4px 10px rgba(247,202,201,0.4); }
        .f-off { background: white; border: 1.5px solid var(--serenity); color: var(--serenity); }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="header"><h1>ğŸ’ 2026 SVT Dream Bank</h1></div>

<div class="top-card">
    <input type="date" id="dateInput" onchange="changeDate()">
    <div class="total-val">$<span id="money">0</span></div>
</div>

<div id="save-page">
    <div class="m-bar">
        <span class="m-label">æœ¬æ¬¡æ¬¡æ•¸ï¼š</span>
        <input type="number" id="customQty" value="1" min="1" onchange="checkQty()">
    </div>
    <div id="m-list"></div>
    <div class="logs">
        <div style="font-weight:bold; color:#999; margin-bottom:10px;">ğŸ“‹ ä»Šæ—¥æ˜ç´°</div>
        <div id="log-list"></div>
    </div>
</div>

<div id="concert-page" class="hidden">
    <div class="card" style="border: 2px solid var(--serenity);">
        <h3 style="margin: 0 0 15px 0; color:var(--serenity); text-align:center;">ğŸŸï¸ ç´€éŒ„æ¼”å”±æœƒæ”¯å‡º</h3>
        <div class="con-form">
            <div class="form-item">
                <label>æ¼”å”±æœƒåç¨±</label>
                <input type="text" id="c-name" placeholder="ä¾‹å¦‚ï¼šFollow to Japan">
            </div>
            
            <div class="form-row">
                <div class="form-item">
                    <label>è²·ç¥¨æ—¥</label>
                    <input type="date" id="c-buy-date">
                </div>
                <div class="form-item">
                    <label>æ´»å‹•æ—¥</label>
                    <input type="date" id="c-event-date">
                </div>
            </div>

            <div class="form-item">
                <label>åº§ä½</label>
                <input type="text" id="c-seat" placeholder="ä¾‹å¦‚ï¼šæ–æ»¾Aå€ 1xxè™Ÿ">
            </div>

            <div class="form-row">
                <div class="form-item">
                    <label>ç¥¨åƒ¹</label>
                    <input type="number" id="c-ticket" placeholder="0">
                </div>
                <div class="form-item">
                    <label>æ‰‹çºŒè²»</label>
                    <input type="number" id="c-fee" placeholder="0">
                </div>
            </div>
            
            <button onclick="addC()" style="width:100%; padding:16px; background:var(--serenity); color:white; border:none; border-radius:15px; font-weight:bold; font-size:16px; margin-top:5px;">ç¢ºèªä¸¦æ‰£æ¬¾</button>
        </div>
    </div>
    <div id="c-list"></div>
</div>

<div class="footer">
    <div id="n1" class="f-btn f-on" onclick="tab(1)">ğŸ’° å­˜éŒ¢</div>
    <div id="n2" class="f-btn f-off" onclick="tab(2)">ğŸŸï¸ æ¼”å”±æœƒè¨˜éŒ„</div>
</div>

<script>
    var state = { total: 0, currentDate: new Date().toISOString().split('T')[0], allLogs: {}, concertLogs: [] };
    var prices = {
        wonwoo: { w_p: 50, w_m: 20, w_s: 30, w_l: 200, i_p: 50, i_s: 30, i_photo: 50, i_live: 200, extra: 10 },
        others: { w_p: 20, w_m: 10, w_s: 10, w_l: 50, i_p: 20, i_s: 10, i_live: 50, extra: 10 }
    };
    var members = [
        {en:"S.coups", ko:"ìŠ¹ì² "}, {en:"Jeonghan", ko:"ì •í•œ"}, {en:"Joshua", ko:"ì§€ìˆ˜"},
        {en:"Jun", ko:"ì¤€íœ˜"}, {en:"Hoshi", ko:"ìˆœì˜"}, {en:"Wonwoo", ko:"ì›ìš°"},
        {en:"Woozi", ko:"ì§€í›ˆ"}, {en:"The8", ko:"ëª…í˜¸"}, {en:"Mingyu", ko:"ë¯¼ê·œ"},
        {en:"DK", ko:"ì„æ•"}, {en:"Seungkwan", ko:"ìŠ¹ê´€"}, {en:"Vernon", ko:"í•œì†”"},
        {en:"Dino", ko:"ì°¬"}
    ];

    function checkQty() {
        var input = document.getElementById('customQty');
        if (input.value < 1) input.value = 1;
    }

    function tab(p) {
        if(p===1) {
            document.getElementById('save-page').classList.remove('hidden');
            document.getElementById('concert-page').classList.add('hidden');
            document.getElementById('n1').className='f-btn f-on';
            document.getElementById('n2').className='f-btn f-off';
        } else {
            document.getElementById('save-page').classList.add('hidden');
            document.getElementById('concert-page').classList.remove('hidden');
            document.getElementById('n1').className='f-btn f-off';
            document.getElementById('n2').className='f-btn f-on';
            renderC();
        }
    }

    function add(name, act, p) {
        var qty = parseInt(document.getElementById('customQty').value) || 1;
        var amt = p * qty;
        var d = state.currentDate;
        if(!state.allLogs[d]) state.allLogs[d] = [];
        state.allLogs[d].push({ id: Date.now(), amt: amt, text: name + " " + act + (qty>1?" (x"+qty+")":"") });
        refresh();
    }

    function live(name, isVip, plat) {
        var p = isVip ? prices.wonwoo : prices.others;
        var n_live = prompt(name + " " + plat + "ç›´æ’­äººæ•¸ï¼Ÿ", "1");
        if(n_live) {
            var qty = parseInt(document.getElementById('customQty').value) || 1;
            var base = (plat === 'WVS' ? p.w_l : p.i_live);
            var singleTotal = parseInt(base) + (parseInt(n_live)>1 ? (parseInt(n_live)-1)*p.extra : 0);
            var finalAmt = singleTotal * qty;
            var d = state.currentDate;
            if(!state.allLogs[d]) state.allLogs[d] = [];
            state.allLogs[d].push({ id: Date.now(), amt: finalAmt, text: name + " " + plat + "ç›´æ’­(" + n_live + "äºº)" + (qty>1?" (x"+qty+")":"") });
            refresh();
        }
    }

    function addC() {
        var name = document.getElementById('c-name').value;
        var buyDate = document.getElementById('c-buy-date').value;
        var eventDate = document.getElementById('c-event-date').value;
        var seat = document.getElementById('c-seat').value;
        var price = parseInt(document.getElementById('c-ticket').value) || 0;
        var fee = parseInt(document.getElementById('c-fee').value) || 0;
        
        if(!name) { alert("è«‹è¼¸å…¥æ¼”å”±æœƒåç¨±"); return; }
        
        state.concertLogs.push({
            id: Date.now(),
            name: name,
            buyDate: buyDate,
            eventDate: eventDate || "9999-12-31", // è‹¥æ²’å¡«æ—¥æœŸå‰‡æ’åˆ°æœ€å¾Œ
            seat: seat,
            price: price,
            fee: fee,
            totalCost: price + fee
        });

        ["c-name", "c-buy-date", "c-event-date", "c-seat", "c-ticket", "c-fee"].forEach(id => document.getElementById(id).value = "");
        refresh();
        renderC();
    }

    function renderC() {
        var h = "";
        // ä¾ç…§æ´»å‹•æ—¥ (eventDate) æ’åºï¼Œç”±è¿‘åˆ°é 
        var sortedLogs = [...state.concertLogs].sort((a, b) => {
            return new Date(a.eventDate) - new Date(b.eventDate);
        });

        sortedLogs.forEach(c => {
            var displayDate = c.eventDate === "9999-12-31" ? "æœªå¡«å¯«" : c.eventDate;
            h += `
            <div class="card ticket">
                <span class="del-btn" onclick="delC(${c.id})">Ã—</span>
                <div class="ticket-header">
                    <b style="font-size:17px; color:#333;">âœ¨ ${c.name}</b>
                </div>
                <div class="ticket-body">
                    ğŸ“… <b>æ´»å‹•æ—¥æœŸï¼š</b>${displayDate}<br>
                    ğŸ“ <b>åº§ä½è³‡è¨Šï¼š</b>${c.seat || 'æœªå¡«å¯«'}<br>
                    ğŸ« <b>è²·ç¥¨æ—¥æœŸï¼š</b>${c.buyDate || 'æœªå¡«å¯«'}<br>
                    ğŸ’° <b>è²»ç”¨æ˜ç´°ï¼š</b>ç¥¨åƒ¹ $${c.price.toLocaleString()} + æ‰‹çºŒè²» $${c.fee.toLocaleString()}
                    <span class="ticket-price">ç¸½è¨ˆ -$${c.totalCost.toLocaleString()}</span>
                </div>
            </div>`;
        });
        document.getElementById('c-list').innerHTML = h || '<div style="color:#ccc;text-align:center;padding:30px;">å°šç„¡æ¼”å”±æœƒç´€éŒ„</div>';
    }

    function delC(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†æ¼”å”±æœƒç´€éŒ„å—ï¼Ÿ")) {
            state.concertLogs = state.concertLogs.filter(function(c){ return c.id !== id; });
            refresh();
            renderC();
        }
    }

    function refresh() {
        var inc = 0, exp = 0;
        for(var d in state.allLogs) {
            state.allLogs[d].forEach(function(l){ inc += l.amt; });
        }
        state.concertLogs.forEach(function(c){ exp += (c.totalCost || 0); });
        state.total = inc - exp;
        localStorage.setItem('SVT_FINAL_STABLE_V1', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('money').innerText = state.total.toLocaleString();
        document.getElementById('dateInput').value = state.currentDate;
        var logs = state.allLogs[state.currentDate] || [];
        var h = "";
        for(var i=logs.length-1; i>=0; i--) {
            h += '<div class="log-line"><span>'+logs[i].text+' ($'+logs[i].amt+')</span><b style="color:red; padding:5px;" onclick="delL('+logs[i].id+')">Ã—</b></div>';
        }
        document.getElementById('log-list').innerHTML = h || '<div style="color:#ccc;text-align:center;padding:10px;">å°šæœªæœ‰å­˜éŒ¢ç´€éŒ„</div>';
    }

    function delL(id) {
        state.allLogs[state.currentDate] = state.allLogs[state.currentDate].filter(function(l){ return l.id !== id; });
        refresh();
    }

    function changeDate() { state.currentDate = document.getElementById('dateInput').value; updateUI(); }

    window.onload = function() {
        var saved = localStorage.getItem('SVT_FINAL_STABLE_V1');
        if(saved) state = JSON.parse(saved);
        if(!state.concertLogs) state.concertLogs = [];
        
        var list = document.getElementById('m-list');
        members.forEach(function(m){
            var isVip = (m.en === "Wonwoo");
            var p = isVip ? prices.wonwoo : prices.others;
            var div = document.createElement('div');
            div.className = 'card';
            var btns = 
                '<button class="btn" onclick="add(\''+m.en+'\',\'WVSç™¼æ–‡\','+p.w_p+')">WVSç™¼æ–‡</button>' +
                '<button class="btn" onclick="add(\''+m.en+'\',\'WVSç•™è¨€\','+p.w_m+')">WVSç•™è¨€</button>' +
                '<button class="btn" onclick="add(\''+m.en+'\',\'WVSé™å‹•\','+p.w_s+')">WVSé™å‹•</button>' +
                '<button class="btn btn-yellow" onclick="live(\''+m.en+'\','+isVip+',\'WVS\')">WVSç›´æ’­</button>' +
                '<button class="btn" onclick="add(\''+m.en+'\',\'IGç™¼æ–‡\','+p.i_p+')">IGç™¼æ–‡</button>' +
                '<button class="btn" onclick="add(\''+m.en+'\',\'IGé™å‹•\','+p.i_s+')">IGé™å‹•</button>' +
                '<button class="btn btn-yellow" onclick="live(\''+m.en+'\','+isVip+',\'IG\')">IGç›´æ’­</button>';
            if(isVip) btns += '<button class="btn btn-purple" onclick="add(\''+m.en+'\',\'IGæ”å½±å¸³\','+p.i_photo+')">IGæ”å½±å¸³</button>';
            div.innerHTML = '<div class="card-title">' + m.en + ' <span class="ko-name">' + m.ko + '</span> ' + (isVip?'ğŸ’œ':'') + '</div><div class="grid">'+btns+'</div>';
            list.appendChild(div);
        });
        refresh();
    };
</script>
</body>
</html>
