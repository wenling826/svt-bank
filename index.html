<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVT Dream Bank</title>
    <style>
        /* åŸºç¤æ¨£å¼é‡ç½® */
        body { font-family: sans-serif; background-color: #fdfbfb; margin: 0; padding-bottom: 120px; color: #333; -webkit-user-select: none; }
        
        /* æ¨™é ­ï¼šç«ç‘°çŸ³è‹±èˆ‡å¯§éœè— */
        .header { background: linear-gradient(to right, #F7CAC9, #92A8D1); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 18px; }

        /* ç¸½é¡é¡¯ç¤º */
        .total-card { background: white; margin: 10px; padding: 15px; border-radius: 15px; border: 2px solid #F7CAC9; display: flex; justify-content: space-between; align-items: center; }
        .amount { color: #e84393; font-size: 24px; font-weight: bold; }

        /* å€æ•¸é¸æ“‡å™¨ (è®Šå¤§æ›´å¥½æŒ‰) */
        .qty-bar { background: #eee; margin: 10px; padding: 5px; border-radius: 10px; display: flex; align-items: center; }
        .qty-btn { flex: 1; padding: 10px; border: none; background: white; margin: 2px; border-radius: 8px; font-weight: bold; font-size: 16px; }
        .qty-active { background: #92A8D1; color: white; }

        /* æˆå“¡å¡ç‰‡ */
        .card { background: white; margin: 15px 10px; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .name { font-size: 18px; font-weight: bold; margin-bottom: 12px; border-bottom: 2px solid #f9f9f9; padding-bottom: 5px; }
        
        /* æŒ‰éˆ•ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 12px 5px; border-radius: 10px; border: 1px solid #eee; background: white; font-size: 14px; cursor: pointer; }
        .btn:active { background: #f0f0f0; transform: scale(0.98); }

        /* æŒ‡å®šæŒ‰éˆ•é¡è‰² (ç›´æ¥å¯«æ­») */
        .btn-live { background-color: #fff9db !important; border-color: #f1c40f !important; color: #d35400 !important; font-weight: bold; }
        .btn-photo { background-color: #f3ebff !important; border-color: #9b59b6 !important; color: #9b59b6 !important; font-weight: bold; }

        /* ç´€éŒ„å€ */
        .log-box { background: #f8f9fa; margin: 10px; padding: 15px; border-radius: 15px; }
        .log-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ccc; font-size: 14px; }

        /* åº•éƒ¨é¸å–® */
        .nav { position: fixed; bottom: 0; width: 100%; background: white; padding: 10px 10px 30px 10px; display: flex; gap: 10px; border-top: 1px solid #eee; }
        .nav-btn { flex: 1; padding: 15px; border-radius: 30px; border: none; font-weight: bold; font-size: 16px; text-align: center; }
        .nav-save { background: #F7CAC9; color: white; }
        .nav-con { background: white; border: 1px solid #92A8D1; color: #92A8D1; }

        /* éš±è—å€å¡Š */
        .hidden { display: none; }

        /* é£„æµ®å‹•ç•« */
        .pop { position: absolute; color: #e84393; font-weight: bold; animation: up 0.8s forwards; pointer-events: none; }
        @keyframes up { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-30px); } }
    </style>
</head>
<body>

<div class="header"><h1>ğŸ’ 2026 SVT Dream Bank</h1></div>

<div class="total-card">
    <input type="date" id="dateInput" onchange="updateDate()" style="font-size: 16px; border:none; background:transparent;">
    <div class="amount">$<span id="totalDisplay">0</span></div>
</div>

<div id="savePage">
    <div class="qty-bar">
        <span style="font-size:12px; margin-right:5px; color:#666;">å€æ•¸</span>
        <button class="qty-btn qty-active" onclick="setQty(1, this)">1</button>
        <button class="qty-btn" onclick="setQty(3, this)">3</button>
        <button class="qty-btn" onclick="setQty(5, this)">5</button>
        <button class="qty-btn" onclick="setQty(10, this)">10</button>
    </div>
    <div id="memberList"></div>
    <div class="log-box">
        <div style="font-weight:bold; color:#888; margin-bottom:10px;">ğŸ“‹ ä»Šæ—¥æ˜ç´°</div>
        <div id="logList"></div>
    </div>
</div>

<div id="concertPage" class="hidden">
    <div class="card" style="border: 2px solid #92A8D1;">
        <p style="text-align:center; font-weight:bold; color:#92A8D1;">ğŸŸï¸ ç™»è¨˜æ¼”å”±æœƒæ”¯å‡º</p>
        <input type="text" id="c_name" placeholder="æ¼”å”±æœƒåç¨±" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px;">
        <input type="date" id="c_date" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px;">
        <input type="number" id="c_cost" placeholder="ç¥¨åƒ¹+æ‰‹çºŒè²» (ç¸½é¡)" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px;">
        <button onclick="addConcert()" style="width:100%; padding:15px; background:#92A8D1; color:white; border:none; border-radius:10px; font-weight:bold;">ç¢ºèªæ‰£æ¬¾</button>
    </div>
    <div id="concertList"></div>
</div>

<div class="nav">
    <button class="nav-btn nav-save" id="btn1" onclick="go(1)">ğŸ’° å­˜éŒ¢</button>
    <button class="nav-btn nav-con" id="btn2" onclick="go(2)">ğŸŸï¸ æˆå°±</button>
</div>

<script>
    let currentQty = 1;
    let state = { total: 0, currentDate: new Date().toISOString().split('T')[0], allLogs: {}, concertLogs: [] };

    const prices = {
        wonwoo: { w_p: 50, w_m: 20, w_s: 30, w_l: 200, i_p: 50, i_s: 30, i_photo: 50, i_live: 200, extra: 10 },
        others: { w_p: 20, w_m: 10, w_s: 10, w_l: 50, i_p: 20, i_s: 10, i_live: 50, extra: 10 }
    };

    const members = ["S.coups", "Jeonghan", "Joshua", "Jun", "Hoshi", "Wonwoo", "Woozi", "The8", "Mingyu", "DK", "Seungkwan", "Vernon", "Dino"];

    function setQty(q, btn) {
        currentQty = q;
        document.querySelectorAll('.qty-btn').forEach(b => b.classList.remove('qty-active'));
        btn.classList.add('qty-active');
    }

    function go(page) {
        if(page === 1) {
            document.getElementById('savePage').classList.remove('hidden');
            document.getElementById('concertPage').classList.add('hidden');
            document.getElementById('btn1').className = 'nav-btn nav-save';
            document.getElementById('btn2').className = 'nav-btn nav-con';
        } else {
            document.getElementById('savePage').classList.add('hidden');
            document.getElementById('concertPage').classList.remove('hidden');
            document.getElementById('btn1').className = 'nav-btn nav-con';
            document.getElementById('btn2').className = 'nav-btn nav-save';
            renderConcerts();
        }
    }

    function add(name, act, price, event) {
        const amt = price * currentQty;
        const dk = state.currentDate;
        if(!state.allLogs[dk]) state.allLogs[dk] = [];
        state.allLogs[dk].push({ id: Date.now(), amt: amt, text: name + " " + act + (currentQty>1?"(x"+currentQty+")":"") });
        
        if(event) {
            const rect = event.target.getBoundingClientRect();
            const p = document.createElement('div');
            p.className = 'pop';
            p.innerText = "+$" + amt;
            p.style.left = rect.left + "px";
            p.style.top = (rect.top + window.scrollY) + "px";
            document.body.appendChild(p);
            setTimeout(()=>p.remove(), 800);
        }
        recalc();
    }

    function recalc() {
        let income = 0, expense = 0;
        Object.keys(state.allLogs).forEach(d => {
            state.allLogs[d].forEach(l => income += l.amt);
        });
        state.concertLogs.forEach(c => expense += c.cost);
        state.total = income - expense;
        save();
    }

    function save() {
        localStorage.setItem('SVT_FINAL_STABLE_V1', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('totalDisplay').innerText = state.total.toLocaleString();
        document.getElementById('dateInput').value = state.currentDate;
        const div = document.getElementById('logList');
        const logs = state.allLogs[state.currentDate] || [];
        div.innerHTML = logs.map(l => `
            <div class="log-item">
                <span>${l.text} ($${l.amt})</span>
                <b style="color:red;" onclick="undo(${l.id})">âœ–</b>
            </div>
        `).reverse().join('');
    }

    function undo(id) {
        state.allLogs[state.currentDate] = state.allLogs[state.currentDate].filter(l => l.id !== id);
        recalc();
    }

    function addConcert() {
        const name = document.getElementById('c_name').value;
        const cost = parseInt(document.getElementById('c_cost').value) || 0;
        const date = document.getElementById('c_date').value;
        if(!name || !date) return;
        state.concertLogs.push({ id: Date.now(), name, cost, date });
        document.getElementById('c_name').value = '';
        document.getElementById('c_cost').value = '';
        recalc();
        renderConcerts();
    }

    function renderConcerts() {
        const list = document.getElementById('concertList');
        list.innerHTML = state.concertLogs.map(c => `
            <div class="card" style="border-left:5px solid gold;">
                <b>âœ¨ ${c.name}</b> <small onclick="delC(${c.id})" style="color:red;float:right;">âœ–</small><br>
                <small>${c.date}</small> <b style="float:right;color:#e84393;">-$${c.cost.toLocaleString()}</b>
            </div>
        `).reverse().join('');
    }

    function delC(id) {
        state.concertLogs = state.concertLogs.filter(c => c.id !== id);
        recalc();
        renderConcerts();
    }

    function updateDate() { state.currentDate = document.getElementById('dateInput').value; updateUI(); }

    function handleLive(name, isVip, plat) {
        const p = isVip ? prices.wonwoo : prices.others;
        const n = prompt(name + " " + plat + "ç›´æ’­äººæ•¸ï¼Ÿ", "1");
        if(n) {
            const base = (plat === 'WVS' ? p.w_l : p.i_live);
            const total = parseInt(base) + (parseInt(n)>1 ? (parseInt(n)-1)*p.extra : 0);
            add(name, plat + "ç›´æ’­(" + n + "äºº)", total);
        }
    }

    function init() {
        const saved = localStorage.getItem('SVT_FINAL_STABLE_V1');
        if(saved) state = JSON.parse(saved);
        if(!state.concertLogs) state.concertLogs = [];
        
        const list = document.getElementById('memberList');
        members.forEach(m => {
            const isVip = (m === "Wonwoo");
            const p = isVip ? prices.wonwoo : prices.others;
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="name">${m} ${isVip?'ğŸ’œ':''}</div>
                <div class="grid">
                    <button class="btn" onclick="add('${m}','WVSç™¼æ–‡',${p.w_p},event)">WVSç™¼æ–‡</button>
                    <button class="btn" onclick="add('${m}','WVSç•™è¨€',${p.w_m},event)">WVSç•™è¨€</button>
                    <button class="btn" onclick="add('${m}','WVSé™å‹•',${p.w_s},event)">WVSé™å‹•</button>
                    <button class="btn btn-live" onclick="handleLive('${m}',${isVip},'WVS')">WVSç›´æ’­</button>
                    <button class="btn" onclick="add('${m}','IGç™¼æ–‡',${p.i_p},event)">IGç™¼æ–‡</button>
                    <button class="btn" onclick="add('${m}','IGé™å‹•',${p.i_s},event)">IGé™å‹•</button>
                    <button class="btn btn-live" onclick="handleLive('${m}',${isVip},'IG')">IGç›´æ’­</button>
                    ${isVip ? `<button class="btn btn-photo" onclick="add('${m}','IGæ”å½±å¸³',${p.i_photo},event)">IGæ”å½±å¸³</button>` : ''}
                </div>
            `;
            list.appendChild(card);
        });
        updateUI();
    }
    init();
</script>
</body>
</html>
