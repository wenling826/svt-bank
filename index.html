<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVT Dream Bank 2026</title>
    <style>
        :root { --rose: #F7CAC9; --serenity: #92A8D1; --purple: #9b59b6; --gold: #f1c40f; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, "PingFang TC", sans-serif; background: #fdfbfb; margin: 0; padding-bottom: 120px; overflow-x: hidden; user-select: none; }
        
        /* æ¨™é ­èˆ‡ç¸½é¡ */
        .header-fixed { position: sticky; top: 0; z-index: 999; background: linear-gradient(to right, var(--rose), var(--serenity)); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 20px; letter-spacing: 1px; }
        .total-box { background: white; padding: 15px; margin: 10px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 2px solid var(--rose); }
        .total-amount { color: #e84393; font-size: 20px; font-weight: bold; }
        #totalDisplay { font-size: 24px; }

        /* è¦–åœ–åˆ‡æ› */
        .view-section { display: none; }
        .view-active { display: block; }

        /* æˆå“¡å¡ç‰‡ */
        .member-card { background: white; margin: 12px; padding: 15px; border-radius: 15px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .member-name { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #333; display: flex; align-items: center; gap: 8px; }
        
        /* æŒ‰éˆ•æ¨£å¼ (å¼·åˆ¶é¡è‰²) */
        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        button { 
            padding: 12px 5px; background: #fff; border: 1px solid #eee; border-radius: 10px; 
            font-size: 14px; color: #555; font-weight: 500; cursor: pointer; transition: 0.1s; 
            position: relative; outline: none; touch-action: manipulation;
        }
        button:active { transform: scale(0.95); background: #f9f9f9; }
        
        /* ç‰¹æ®ŠæŒ‰éˆ•é¡è‰² (åŠ å¼·æ¬Šé‡) */
        .btn-live { background-color: #fff9db !important; border-color: #f1c40f !important; color: #d35400 !important; font-weight: bold; }
        .btn-photo { background-color: #f5f6fa !important; border-color: var(--purple) !important; color: var(--purple) !important; font-weight: bold; }
        
        /* é•·æŒ‰æ™‚çš„è¦–è¦ºå›é¥‹ */
        .btn-pressing { transform: scale(0.92); border-color: var(--serenity) !important; background-color: #e3f2fd !important; }

        /* é£„æµ®å‹•ç•« */
        .plus-money { position: absolute; color: #e84393; font-weight: bold; animation: floatUp 0.8s forwards; z-index: 1000; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-40px); } }

        /* æ¼”å”±æœƒè¡¨å–® */
        .concert-form { background: white; margin: 12px; padding: 20px; border-radius: 15px; border: 2px solid var(--serenity); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; }
        .save-concert-btn { background: var(--serenity); color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 16px; margin-top: 10px; }
        .concert-card { background: #fff; margin: 12px; padding: 15px; border-radius: 12px; border-left: 5px solid var(--gold); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* åº•éƒ¨å°èˆª */
        .footer { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); padding: 10px 20px 30px 20px; border-top: 1px solid #eee; backdrop-filter: blur(10px); display: flex; gap: 10px; z-index: 1000; }
        .nav-btn { flex: 1; padding: 12px; border-radius: 25px; border: none; font-weight: bold; font-size: 14px; }
        .btn-main { background: var(--rose); color: white; }
        .btn-sub { background: white; border: 1px solid var(--serenity); color: var(--serenity); }

        .log-area { margin: 15px; background: #f8f9fa; padding: 15px; border-radius: 12px; min-height: 80px; }
        .day-total-tag { background: linear-gradient(135deg, var(--rose), var(--serenity)); color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 15px; font-weight: bold; font-size: 14px; }
        .log-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ddd; font-size: 14px; }
    </style>
</head>
<body>

<div class="header-fixed"><h1 id="pageTitle">ğŸ’ 2026 SVT Dream Bank</h1></div>

<div class="total-box">
    <div id="dateSection">
        <input type="date" id="dateInput" onchange="updateDate()" style="border: 1px solid #ddd; padding: 8px; border-radius: 8px;">
    </div>
    <div id="countSection" style="display:none; font-weight:bold; color:var(--purple);">
        è¦‹é¢æ¬¡æ•¸ï¼š<span id="meetCount">0</span> æ¬¡
    </div>
    <div class="total-amount">é¤˜é¡ $<span id="totalDisplay">0</span></div>
</div>

<div id="saveView" class="view-section view-active">
    <div id="memberList"></div>
    <div class="log-area">
        <div style="font-weight:bold; margin-bottom:10px; color:#666;">ğŸ“‹ ä»Šæ—¥å­˜éŒ¢æ˜ç´°</div>
        <div id="logList"></div>
    </div>
</div>

<div id="concertView" class="view-section">
    <div class="concert-form">
        <div style="font-weight:bold; margin-bottom:15px; color:var(--serenity); text-align:center;">ğŸŸï¸ æ–°å¢æ¼”å”±æœƒé–€ç¥¨æ”¯å‡º</div>
        <div class="form-group"><label>æ¼”å”±æœƒåç¨±</label><input type="text" id="c_name" placeholder="ä¾‹å¦‚ï¼šFOLLOW AGAIN"></div>
        <div class="form-group"><label>è²·ç¥¨æ—¥</label><input type="date" id="c_buyDate"></div>
        <div class="form-group"><label>æ´»å‹•æ—¥</label><input type="date" id="c_showDate"></div>
        <div class="form-group"><label>åº§ä½</label><input type="text" id="c_seat" placeholder="ä¾‹å¦‚ï¼šVIP Aå€"></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="form-group"><label>ç¥¨åƒ¹</label><input type="number" id="c_price" placeholder="0"></div>
            <div class="form-group"><label>æ‰‹çºŒè²»</label><input type="number" id="c_fee" placeholder="0"></div>
        </div>
        <button class="save-concert-btn" onclick="addConcert()">ç¢ºèªå„²å­˜ä¸¦æ‰£æ¬¾</button>
    </div>
    <div style="font-weight:bold; margin:20px 15px 10px; color:#666;">ğŸ“œ 2026 è¦‹é¢ç´€éŒ„</div>
    <div id="concertList"></div>
</div>

<div class="footer">
    <button id="btnToSave" class="nav-btn btn-main" onclick="switchView('save')">ğŸ’° å­˜éŒ¢æ¨¡å¼</button>
    <button id="btnToConcert" class="nav-btn btn-sub" onclick="switchView('concert')">ğŸŸï¸ æ¼”å”±æœƒæˆå°±</button>
</div>

<script>
    // --- åƒ¹æ ¼è¨­å®š (è¦ªæ°‘ç‰ˆ) ---
    const prices = {
        wonwoo: { w_p: 50, w_m: 20, w_s: 30, w_l: 200, i_p: 50, i_s: 30, i_photo: 50, i_live: 200, extra: 10 },
        others: { w_p: 20, w_m: 10, w_s: 10, w_l: 50, i_p: 20, i_s: 10, i_live: 50, extra: 10 }
    };

    const members = [
        {en:"S.coups", ko:"ìŠ¹ì² ", vip:false}, {en:"Jeonghan", ko:"ì •í•œ", vip:false},
        {en:"Joshua", ko:"ì§€ìˆ˜", vip:false}, {en:"Jun", ko:"ì¤€íœ˜", vip:false},
        {en:"Hoshi", ko:"ìˆœì˜", vip:false}, {en:"Wonwoo", ko:"ì›ìš°", vip:true},
        {en:"Woozi", ko:"ì§€í›ˆ", vip:false}, {en:"The8", ko:"ëª…í˜¸", vip:false},
        {en:"Mingyu", ko:"ë¯¼ê·œ", vip:false}, {en:"DK", ko:"ì„ë¯¼", vip:false},
        {en:"Seungkwan", ko:"ìŠ¹ê´€", vip:false}, {en:"Vernon", ko:"í•œì†”", vip:false},
        {en:"Dino", ko:"ì°¬", vip:false}
    ];

    function getToday() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
    }

    // --- é•·æŒ‰é‚è¼¯æ§åˆ¶å™¨ ---
    let pressTimer = null;
    let isLongPress = false;

    // æŒ‰ä¸‹é–‹å§‹
    function startPress(btn, name, act, price) {
        isLongPress = false;
        btn.classList.add('btn-pressing'); // æŒ‰å£“æ•ˆæœ
        
        // è¨­å®šé•·æŒ‰è¨ˆæ™‚å™¨ (600æ¯«ç§’)
        pressTimer = setTimeout(() => {
            isLongPress = true;
            btn.classList.remove('btn-pressing');
            if(navigator.vibrate) navigator.vibrate(50); // éœ‡å‹•å›é¥‹
            
            // è·³å‡ºè¼¸å…¥æ¡†
            const count = prompt(`ã€${name}ã€‘${act}\nè«‹è¼¸å…¥æ•¸é‡ (ä¾‹å¦‚ 5 å‰‡)ï¼š`, "1");
            if(count && !isNaN(count) && count > 0) {
                // é€™è£¡æˆ‘å€‘ä¸å‚³ eventï¼Œå› ç‚º prompt æœƒä¸­æ–·è¦–è¦ºæµï¼Œç›´æ¥åŠ éŒ¢
                add(name, `${act} (x${count})`, price * parseInt(count), null);
            }
        }, 600);
    }

    // æ”¾é–‹çµæŸ
    function endPress(btn, name, act, price, event) {
        clearTimeout(pressTimer); // æ¸…é™¤è¨ˆæ™‚
        btn.classList.remove('btn-pressing');
        
        // å¦‚æœä¸æ˜¯é•·æŒ‰ (æ™‚é–“æ²’åˆ°å°±æ”¾é–‹)ï¼Œå‰‡è¦–ç‚ºæ™®é€šé»æ“Š
        if (!isLongPress) {
            add(name, act, price, event);
        }
        // é˜²æ­¢è§¸ç™¼å…©æ¬¡
        if(event) event.preventDefault();
    }

    // æ‰‹æŒ‡æ»‘é–‹å–æ¶ˆ
    function cancelPress(btn) {
        clearTimeout(pressTimer);
        btn.classList.remove('btn-pressing');
    }

    // --- è³‡æ–™ç‹€æ…‹ ---
    let state = { 
        total: 0, currentDate: getToday(), allLogs: {}, concertLogs: [] 
    };

    // --- æ ¸å¿ƒåŠŸèƒ½ ---
    function switchView(mode) {
        if(mode === 'save') {
            document.getElementById('saveView').classList.add('view-active');
            document.getElementById('concertView').classList.remove('view-active');
            document.getElementById('btnToSave').className = 'nav-btn btn-main';
            document.getElementById('btnToConcert').className = 'nav-btn btn-sub';
            document.getElementById('pageTitle').innerText = 'ğŸ’ 2026 SVT Dream Bank';
            document.getElementById('dateSection').style.display = 'block';
            document.getElementById('countSection').style.display = 'none';
        } else {
            document.getElementById('saveView').classList.remove('view-active');
            document.getElementById('concertView').classList.add('view-active');
            document.getElementById('btnToSave').className = 'nav-btn btn-sub';
            document.getElementById('btnToConcert').className = 'nav-btn btn-main';
            document.getElementById('pageTitle').innerText = 'ğŸŸï¸ æ¼”å”±æœƒæˆå°±é¤¨';
            document.getElementById('dateSection').style.display = 'none';
            document.getElementById('countSection').style.display = 'block';
            renderConcerts();
        }
    }

    function addConcert() {
        const name = document.getElementById('c_name').value;
        const buyDate = document.getElementById('c_buyDate').value;
        const showDate = document.getElementById('c_showDate').value;
        const seat = document.getElementById('c_seat').value;
        const price = parseInt(document.getElementById('c_price').value) || 0;
        const fee = parseInt(document.getElementById('c_fee').value) || 0;

        if(!name || !showDate) { alert('è«‹å¡«å¯«æ¼”å”±æœƒåç¨±èˆ‡æ´»å‹•æ—¥ï¼'); return; }

        state.concertLogs.push({
            id: Date.now(), name, buyDate, showDate, seat, price, fee,
            totalCost: price + fee
        });
        
        // æ¸…ç©ºè¼¸å…¥
        document.getElementById('c_name').value = '';
        document.getElementById('c_price').value = '';
        document.getElementById('c_fee').value = '';
        recalculateTotal();
        renderConcerts();
    }

    function deleteConcert(id) {
        if(!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) return;
        state.concertLogs = state.concertLogs.filter(c => c.id !== id);
        recalculateTotal();
        renderConcerts();
    }

    function renderConcerts() {
        const list = document.getElementById('concertList');
        const count = state.concertLogs.length;
        document.getElementById('meetCount').innerText = count;
        if(count === 0) { list.innerHTML = '<div style="color:#aaa;text-align:center;padding:30px;">å°šç„¡ç´€éŒ„</div>'; return; }
        list.innerHTML = state.concertLogs.map(c => `
            <div class="concert-card">
                <div style="display:flex; justify-content:space-between;">
                    <div class="concert-title">âœ¨ ${c.name}</div>
                    <div style="color:#ff7675; cursor:pointer; font-weight:bold;" onclick="deleteConcert(${c.id})">âœ–</div>
                </div>
                <div style="font-size:13px; color:#777; line-height:1.6;">ğŸ“… æ´»å‹•ï¼š${c.showDate}<br>ğŸ“ åº§ä½ï¼š${c.seat || '-'}</div>
                <div style="color:#e84393; font-weight:bold; margin-top:8px; text-align:right;">æ”¯å‡ºï¼š$${(c.totalCost).toLocaleString()}</div>
            </div>
        `).reverse().join('');
    }

    function recalculateTotal() {
        let income = 0;
        let expense = 0;
        Object.keys(state.allLogs).forEach(date => {
            state.allLogs[date].forEach(log => {
                const isVip = log.text.includes("Wonwoo");
                const p = isVip ? prices.wonwoo : prices.others;
                const txt = log.text;
                // é‡‘é¡æ ¡æ­£é‚è¼¯
                if(log.amt === undefined) log.amt = 0; // é˜²æ­¢èˆŠè³‡æ–™éŒ¯èª¤
                // è‹¥ç‚ºæ‰‹å‹•è¼¸å…¥å€æ•¸çš„ç´€éŒ„(åŒ…å« "x"), ä¸é‡æ–°è¨ˆç®—å–®åƒ¹ï¼Œä¿ç•™ç•¶æ™‚é‡‘é¡
                if(txt.includes("(x")) {
                    income += log.amt;
                    return;
                }
                
                // ä¸€èˆ¬ç´€éŒ„é‡ç®—
                if (txt.includes("WVSç™¼æ–‡")) log.amt = p.w_p;
                else if (txt.includes("WVSç•™è¨€")) log.amt = p.w_m;
                else if (txt.includes("WVSé™å‹•")) log.amt = p.w_s;
                else if (txt.includes("IGç™¼æ–‡")) log.amt = p.i_p;
                else if (txt.includes("IGé™å‹•")) log.amt = p.i_s;
                else if (txt.includes("IGæ”å½±å¸³")) log.amt = p.i_photo;
                else if (txt.includes("ç›´æ’­")) {
                    const match = txt.match(/\((\d+)äºº\)/);
                    const count = match ? parseInt(match[1]) : 1;
                    const base = txt.includes("WVS") ? p.w_l : p.i_live;
                    log.amt = base + (count > 1 ? (count - 1) * p.extra : 0);
                }
                income += log.amt;
            });
        });
        state.concertLogs.forEach(c => expense += c.totalCost);
        state.total = income - expense;
        save();
    }

    function triggerEffect(element, amount) {
        if(!element) return;
        element.classList.add('btn-pressing'); // å€Ÿç”¨æŒ‰å£“æ¨£å¼
        setTimeout(() => element.classList.remove('btn-pressing'), 200);
        const rect = element.getBoundingClientRect();
        const plus = document.createElement('div');
        plus.className = 'plus-money';
        plus.innerText = `+$${amount}`;
        plus.style.left = `${rect.left + rect.width/2 - 20}px`;
        plus.style.top = `${rect.top + window.scrollY}px`;
        document.body.appendChild(plus);
        setTimeout(() => plus.remove(), 800);
    }

    function save() {
        localStorage.setItem('SVT_FINAL_STABLE_V1', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('totalDisplay').innerText = state.total.toLocaleString();
        document.getElementById('dateInput').value = state.currentDate;
        renderLogs();
    }

    function add(name, act, amt, event) {
        const dk = state.currentDate;
        if (!state.allLogs[dk]) state.allLogs[dk] = [];
        state.allLogs[dk].push({ id: Date.now(), amt: amt, text: `${name} ${act}` });
        if(event) triggerEffect(event.currentTarget, amt);
        recalculateTotal();
    }

    function undo(id) {
        const dk = state.currentDate;
        const logs = state.allLogs[dk];
        const idx = logs.findIndex(l => l.id === id);
        if(idx !== -1) { logs.splice(idx, 1); recalculateTotal(); }
    }

    function renderLogs() {
        const div = document.getElementById('logList');
        const logs = state.allLogs[state.currentDate] || [];
        const dayTotal = logs.reduce((sum, log) => sum + log.amt, 0);
        const totalHtml = dayTotal > 0 ? `<div class="day-total-tag">ğŸ’° æœ¬æ—¥ç¸½è¨ˆï¼šNT$ ${dayTotal.toLocaleString()}</div>` : '';
        if(logs.length === 0) { div.innerHTML = '<div style="color:#aaa;text-align:center;padding:20px;">é€™å¤©å°šæœªæœ‰ç´€éŒ„</div>'; return; }
        div.innerHTML = totalHtml + logs.map(l => `
            <div class="log-item">
                <span>${l.text} ($${l.amt})</span>
                <span style="color:#ff7675;font-weight:bold;padding:0 15px;cursor:pointer;" onclick="undo(${l.id})">âœ–</span>
            </div>
        `).reverse().join('');
    }

    // ç›´æ’­ä¿æŒé»æ“Šè§¸ç™¼ï¼Œå› ç‚ºå®ƒåŸæœ¬å°±è¦è¼¸å…¥äººæ•¸
    function handleLive(idx, plat, event) {
        const m = members[idx];
        const p = m.vip ? prices.wonwoo : prices.others;
        const n = prompt(`ã€${m.en}ã€‘${plat}ç›´æ’­äººæ•¸ï¼Ÿ(Soloè«‹å¡«1)`, "1");
        if(n && !isNaN(n)) {
            let base = (plat === 'WVS' ? p.w_l : p.i_live);
            let total = parseInt(base) + (parseInt(n)>1 ? (parseInt(n)-1)*p.extra : 0);
            add(m.en, `${plat}ç›´æ’­(${n}äºº)`, total, event);
        }
    }

    function updateDate() { state.currentDate = document.getElementById('dateInput').value; save(); }
    
    function nextDay() {
        if(!confirm("ç¢ºå®šè¦çµæŸä»Šå¤©ï¼Œä¸¦è·³åˆ°ä¸‹ä¸€å¤©å—ï¼Ÿ")) return;
        let d = new Date(state.currentDate);
        d.setDate(d.getDate() + 1);
        state.currentDate = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        save();
        window.scrollTo(0,0);
    }

    function init() {
        const saved = localStorage.getItem('SVT_FINAL_STABLE_V1');
        if(saved) {
            state = JSON.parse(saved);
            if(!state.concertLogs) state.concertLogs = [];
            state.currentDate = getToday();
            recalculateTotal();
        }
        
        const list = document.getElementById('memberList');
        list.innerHTML = '';
        members.forEach((m, i) => {
            const p = m.vip ? prices.wonwoo : prices.others;
            const card = document.createElement('div');
            card.className = 'member-card';
            
            // ç¶å®šé•·æŒ‰äº‹ä»¶çš„æŒ‰éˆ•ç”Ÿæˆå™¨
            const makeBtn = (txt, act, price, cls='') => `
                <button class="${cls}" 
                    onmousedown="startPress(this, '${m.en}', '${act}', ${price})" 
                    ontouchstart="startPress(this, '${m.en}', '${act}', ${price})" 
                    onmouseup="endPress(this, '${m.en}', '${act}', ${price}, event)" 
                    ontouchend="endPress(this, '${m.en}', '${act}', ${price}, event)"
                    oncontextmenu="return false;"
                    onmouseleave="cancelPress(this)">${txt}</button>
            `;

            let btns = `
                ${makeBtn('WVSç™¼æ–‡', 'WVSç™¼æ–‡', p.w_p)}
                ${makeBtn('WVSç•™è¨€', 'WVSç•™è¨€', p.w_m)}
                ${makeBtn('WVSé™å‹•', 'WVSé™å‹•', p.w_s)}
                <button class="btn-live" onclick="handleLive(${i},'WVS', event)">WVSç›´æ’­</button>
                ${makeBtn('IGç™¼æ–‡', 'IGç™¼æ–‡', p.i_p)}
                ${makeBtn('IGé™å‹•', 'IGé™å‹•', p.i_s)}
                <button class="btn-live" onclick="handleLive(${i},'IG', event)">IGç›´æ’­</button>
            `;
            if(m.vip) btns += makeBtn('IGæ”å½±å¸³', 'IGæ”å½±å¸³', p.i_photo, 'btn-photo');
            
            card.innerHTML = `<div class="member-name">${m.en} <span style="font-size:14px;color:#888;">${m.ko}</span> ${m.vip?'ğŸ’œ':''}</div><div class="btn-grid">${btns}</div>`;
            list.appendChild(card);
        });
        updateUI();
    }
    init();
</script>
</body>
</html>
