<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVT Dream Bank 2026</title>
    <style>
        :root { --rose: #F7CAC9; --serenity: #92A8D1; --purple: #9b59b6; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, "PingFang TC", sans-serif; background: #fdfbfb; margin: 0; padding-bottom: 120px; overflow-x: hidden; }
        
        .header-fixed { position: sticky; top: 0; z-index: 999; background: linear-gradient(to right, var(--rose), var(--serenity)); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 20px; letter-spacing: 1px; }
        
        .total-box { background: white; padding: 15px; margin: 10px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 2px solid var(--rose); }
        #dateInput { border: 1px solid #ddd; padding: 8px; border-radius: 8px; font-size: 16px; color: #555; outline: none; background: #fff; }
        .total-amount { color: #e84393; font-size: 20px; font-weight: bold; }
        #totalDisplay { font-size: 24px; }

        .member-card { background: white; margin: 12px; padding: 15px; border-radius: 15px; border: 1px solid #eee; box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: relative; }
        .member-name { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #333; display: flex; align-items: center; gap: 8px; }
        
        .btn-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        
        /* æŒ‰éˆ•åŸºç¤æ¨£å¼ */
        button { 
            position: relative; padding: 12px 5px; background: #fff; border: 1px solid #eee; 
            border-radius: 10px; font-size: 14px; color: #555; cursor: pointer; 
            transition: all 0.2s; font-weight: 500; outline: none; 
        }
        
        /* é»æ“Šæ™‚çš„é–ƒçˆå›é¥‹ */
        .btn-flash { background-color: var(--serenity) !important; color: white !important; transform: scale(0.92); }
        
        .btn-live { background-color: #fff9db; border-color: #f1c40f; color: #d35400; font-weight: bold; }
        .btn-photo { background-color: #f5f6fa; border-color: var(--purple); color: var(--purple); font-weight: bold; }
        
        /* é£„æµ®æ•¸å­—å‹•ç•« */
        .plus-money {
            position: absolute; color: #e84393; font-weight: bold; font-size: 18px;
            pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 1000;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-40px); }
        }

        .log-area { margin: 15px; background: #f8f9fa; padding: 15px; border-radius: 12px; min-height: 80px; }
        .day-total-tag { background: linear-gradient(135deg, var(--rose), var(--serenity)); color: white; padding: 8px 16px; border-radius: 20px; display: inline-block; margin-bottom: 15px; font-weight: bold; font-size: 15px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
        .log-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ddd; font-size: 14px; align-items: center; }
        
        .footer { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); padding: 15px 20px 30px 20px; text-align: center; border-top: 1px solid #eee; backdrop-filter: blur(10px); }
        .next-btn { background: var(--rose); color: white; border: none; padding: 14px; border-radius: 30px; width: 100%; font-size: 16px; font-weight: bold; box-shadow: 0 4px 15px rgba(247,202,201,0.6); }
    </style>
</head>
<body>

<div class="header-fixed"><h1>ğŸ’ 2026 SVT Dream Bank</h1></div>

<div class="total-box">
    <input type="date" id="dateInput" onchange="updateDate()">
    <div class="total-amount">ç¸½é¡ $<span id="totalDisplay">0</span></div>
</div>

<div id="memberList"></div>

<div class="log-area">
    <div class="log-header" style="font-weight:bold; margin-bottom:10px; color:#666;">ğŸ“‹ ä»Šæ—¥å­˜éŒ¢æ˜ç´°</div>
    <div id="logList"></div>
</div>

<div class="footer">
    <button class="next-btn" onclick="nextDay()">âœ… ç¢ºèªä¸¦é€²å…¥ä¸‹ä¸€å¤©</button>
</div>

<script>
    // --- 1. æœ€æ–°ç˜¦èº«ç‰ˆåƒ¹æ ¼ ---
    const prices = {
        wonwoo: { w_p: 50, w_m: 20, w_s: 30, w_l: 200, i_p: 50, i_s: 30, i_photo: 50, i_live: 200, extra: 10 },
        others: { w_p: 20, w_m: 10, w_s: 10, w_l: 50, i_p: 20, i_s: 10, i_live: 50, extra: 10 }
    };

    const members = [
        {en:"S.coups", ko:"ìŠ¹ì² ", vip:false}, {en:"Jeonghan", ko:"ì •í•œ", vip:false},
        {en:"Joshua", ko:"ì§€ìˆ˜", vip:false}, {en:"Jun", ko:"ì¤€íœ˜", vip:false},
        {en:"Hoshi", ko:"ìˆœì˜", vip:false}, {en:"Wonwoo", ko:"ì›ìš°", vip:true},
        {en:"Woozi", ko:"ì§€í›ˆ", vip:false}, {en:"The8", ko:"ëª…í˜¸", vip:false},
        {en:"Mingyu", ko:"ë¯¼ê·œ", vip:false}, {en:"DK", ko:"ì„æ•", vip:false},
        {en:"Seungkwan", ko:"ìŠ¹ê´€", vip:false}, {en:"Vernon", ko:"í•œì†”", vip:false},
        {en:"Dino", ko:"ì°¬", vip:false}
    ];

    function getToday() {
        const now = new Date();
        return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
    }

    let state = { total: 0, currentDate: getToday(), allLogs: {} };

    // --- 2. è¦–è¦ºç‰¹æ•ˆåŠŸèƒ½ ---
    function triggerEffect(element, amount) {
        // æŒ‰éˆ•é–ƒçˆ
        element.classList.add('btn-flash');
        setTimeout(() => element.classList.remove('btn-flash'), 200);

        // é£„æµ®é‡‘é¡
        const rect = element.getBoundingClientRect();
        const plus = document.createElement('div');
        plus.className = 'plus-money';
        plus.innerText = `+$${amount}`;
        plus.style.left = `${rect.left + rect.width/2 - 20}px`;
        plus.style.top = `${rect.top + window.scrollY}px`;
        document.body.appendChild(plus);
        setTimeout(() => plus.remove(), 800);
    }

    function recalculateAllHistory() {
        let newGlobalTotal = 0;
        Object.keys(state.allLogs).forEach(date => {
            state.allLogs[date].forEach(log => {
                const isVip = log.text.includes("Wonwoo");
                const p = isVip ? prices.wonwoo : prices.others;
                const txt = log.text;
                if (txt.includes("WVSç™¼æ–‡")) log.amt = p.w_p;
                else if (txt.includes("WVSç•™è¨€")) log.amt = p.w_m;
                else if (txt.includes("WVSé™å‹•")) log.amt = p.w_s;
                else if (txt.includes("IGç™¼æ–‡")) log.amt = p.i_p;
                else if (txt.includes("IGé™å‹•")) log.amt = p.i_s;
                else if (txt.includes("IGæ”å½±å¸³")) log.amt = p.i_photo;
                else if (txt.includes("ç›´æ’­")) {
                    const match = txt.match(/\((\d+)äºº\)/);
                    const count = match ? parseInt(match[1]) : 1;
                    const base = txt.includes("WVS") ? p.w_l : p.i_live;
                    log.amt = base + (count > 1 ? (count - 1) * p.extra : 0);
                }
                newGlobalTotal += log.amt;
            });
        });
        state.total = newGlobalTotal;
        save();
    }

    function save() {
        localStorage.setItem('SVT_FINAL_STABLE_V1', JSON.stringify(state));
        updateUI();
    }

    function updateUI() {
        document.getElementById('totalDisplay').innerText = state.total.toLocaleString();
        document.getElementById('dateInput').value = state.currentDate;
        renderLogs();
    }

    function add(name, act, amt, event) {
        state.total += amt;
        const dk = state.currentDate;
        if (!state.allLogs[dk]) state.allLogs[dk] = [];
        state.allLogs[dk].push({ id: Date.now(), amt: amt, text: `${name} ${act}` });
        if(event) triggerEffect(event.currentTarget, amt);
        save();
    }

    function undo(id) {
        const dk = state.currentDate;
        const logs = state.allLogs[dk];
        const idx = logs.findIndex(l => l.id === id);
        if(idx !== -1) {
            state.total -= logs[idx].amt;
            logs.splice(idx, 1);
            save();
        }
    }

    function renderLogs() {
        const div = document.getElementById('logList');
        const logs = state.allLogs[state.currentDate] || [];
        const dayTotal = logs.reduce((sum, log) => sum + log.amt, 0);
        const totalHtml = dayTotal > 0 ? `<div class="day-total-tag">ğŸ’° æœ¬æ—¥ç¸½è¨ˆï¼šNT$ ${dayTotal.toLocaleString()}</div>` : '';
        if(logs.length === 0) { 
            div.innerHTML = '<div style="color:#aaa;text-align:center;padding:20px;">é€™å¤©å°šæœªæœ‰ç´€éŒ„</div>'; 
            return; 
        }
        div.innerHTML = totalHtml + logs.map(l => `
            <div class="log-item">
                <span>${l.text} ($${l.amt})</span>
                <span style="color:#ff7675;font-weight:bold;padding:0 15px;cursor:pointer;" onclick="undo(${l.id})">âœ–</span>
            </div>
        `).reverse().join('');
    }

    function handleLive(idx, plat, event) {
        const m = members[idx];
        const p = m.vip ? prices.wonwoo : prices.others;
        const n = prompt(`ã€${m.en}ã€‘${plat}ç›´æ’­äººæ•¸ï¼Ÿ(Soloè«‹å¡«1)`, "1");
        if(n && !isNaN(n)) {
            let base = (plat === 'WVS' ? p.w_l : p.i_live);
            let total = parseInt(base) + (parseInt(n)>1 ? (parseInt(n)-1)*p.extra : 0);
            add(m.en, `${plat}ç›´æ’­(${n}äºº)`, total, event);
        }
    }

    function updateDate() {
        state.currentDate = document.getElementById('dateInput').value;
        save();
    }

    function nextDay() {
        if(!confirm("ç¢ºå®šè¦çµæŸä»Šå¤©ï¼Œä¸¦è·³åˆ°ä¸‹ä¸€å¤©å—ï¼Ÿ")) return;
        let d = new Date(state.currentDate);
        d.setDate(d.getDate() + 1);
        state.currentDate = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        save();
        window.scrollTo(0,0);
    }

    function init() {
        const saved = localStorage.getItem('SVT_FINAL_STABLE_V1');
        if(saved) {
            state = JSON.parse(saved);
            state.currentDate = getToday();
            recalculateAllHistory();
        }
        
        const list = document.getElementById('memberList');
        list.innerHTML = '';
        members.forEach((m, i) => {
            const p = m.vip ? prices.wonwoo : prices.others;
            const card = document.createElement('div');
            card.className = 'member-card';
            let btns = `
                <button onclick="add('${m.en}','WVSç™¼æ–‡',${p.w_p}, event)">WVSç™¼æ–‡</button>
                <button onclick="add('${m.en}','WVSç•™è¨€',${p.w_m}, event)">WVSç•™è¨€</button>
                <button onclick="add('${m.en}','WVSé™å‹•',${p.w_s}, event)">WVSé™å‹•</button>
                <button class="btn-live" onclick="handleLive(${i},'WVS', event)">WVSç›´æ’­</button>
                <button onclick="add('${m.en}','IGç™¼æ–‡',${p.i_p}, event)">IGç™¼æ–‡</button>
                <button onclick="add('${m.en}','IGé™å‹•',${p.i_s}, event)">IGé™å‹•</button>
                <button class="btn-live" onclick="handleLive(${i},'IG', event)">IGç›´æ’­</button>
            `;
            if(m.vip) btns += `<button class="btn-photo" onclick="add('${m.en}','IGæ”å½±å¸³',${p.i_photo}, event)">IGæ”å½±å¸³</button>`;
            card.innerHTML = `<div class="member-name">${m.en} <span style="font-size:14px;color:#888;font-weight:normal;">${m.ko}</span> ${m.vip?'ğŸ’œ':''}</div><div class="btn-grid">${btns}</div>`;
            list.appendChild(card);
        });
        updateUI();
    }
    init();
</script>
</body>
</html>
